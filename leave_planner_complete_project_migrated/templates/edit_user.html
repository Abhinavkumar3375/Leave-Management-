<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Edit User</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
    background: url("/static/photos/1.jpg") no-repeat center center fixed;
    background-size: cover;
    font-family: "Poppins", sans-serif;
}

.bg-glass{
    backdrop-filter: blur(12px);
    background: rgba(255,255,255,0.75);
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    max-width: 450px;
    margin: auto;
}

.title-box{
    text-align: center;
    font-size: 22px;
    font-weight: 600;
    color: #333;
    margin-bottom: 15px;
}

input:focus, select:focus{
    border-color:#6366f1;
    box-shadow:0 0 0 .2rem rgba(99,102,241, .25);
}

.btn-primary{
    background:#4e5bff;
    border:none;
}

.btn-primary:hover{
    background:#3541ff;
}

#pwBar{
    height:6px;
    width:0%;
    background:red;
    border-radius:6px;
    transition:.3s;
}
</style>
</head>

<body class="d-flex justify-content-center align-items-center vh-100">

<div class="bg-glass">
    <div class="title-box">Edit User - {{user.username}}</div>

    <form method="post">

        <label>Name</label>
        <input class="form-control mb-2" name="name" value="{{user.name}}" required>

        <label>Username</label>
        <input class="form-control mb-2" name="username" value="{{user.username}}" required>

        {% if session.role=='superadmin' %}
        <label>Role</label>
        <select name="role" class="form-select mb-2">
            <option value="employee" {% if user.role=='employee' %}selected{% endif %}>Employee</option>
            <option value="admin" {% if user.role=='admin' %}selected{% endif %}>Admin</option>
            <option value="superadmin" {% if user.role=='superadmin' %}selected{% endif %}>Super Admin</option>
        </select>

        <label>Department</label>
        <input class="form-control mb-2" name="department" value="{{user.department}}">
        {% endif %}

        <label>New Password (optional)</label>
        <div class="input-group mb-1">
            <input type="password" id="pw" class="form-control" name="password"
                   placeholder="Leave blank to keep current">
            <button type="button" class="btn btn-outline-secondary" id="showBtn">Show</button>
        </div>

        <div id="pwBar"></div>

        <button class="btn btn-primary w-100 mt-3">Save Changes</button>
        <a href="/users" class="btn btn-link w-100">Cancel</a>
    </form>
</div>

<script>
// Toggle password
document.getElementById("showBtn").onclick = () => {
    let p = document.getElementById("pw");
    p.type = (p.type === "password") ? "text" : "password";
};

// strength bar
document.getElementById("pw").oninput = () => {
    let v = pw.value, s=0;
    if(v.length>=8) s++; if(/[A-Z]/.test(v)) s++; if(/[0-9]/.test(v)) s++; if(/[^A-Za-z0-9]/.test(v)) s++;
    let bar = document.getElementById("pwBar");
    bar.style.width = (s*25)+"%";
    bar.style.background = s>=3 ? "green" : "red";
};
</script>

</body>
</html>
